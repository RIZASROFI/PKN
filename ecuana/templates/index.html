<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Cuaca | Monitoring Cuaca Desa Sumberejo</title>
    {% load static %}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>üå§Ô∏è</text></svg>">
</head>
<body>
    <!-- Background Animation -->
    <div class="background-animation">
        <div class="cloud cloud-1"></div>
        <div class="cloud cloud-2"></div>
        <div class="cloud cloud-3"></div>
        <div class="sun"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo-icon">üå§Ô∏è</div>
                    <div class="logo-text">
                        <h1 class="title">E-Cuaca</h1>
                        <p class="subtitle">Sistem Monitoring Cuaca Real-Time</p>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="refresh-info" id="refreshCountdown">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh dalam: <span id="countdown">10:00</span></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Location Info Card -->
            <div class="card location-card">
                <div class="location-header">
                    <h2><i class="fas fa-map-marker-alt"></i> Lokasi Monitoring</h2>
                </div>
                <div class="location-content">
                    <div class="location-icon">
                        <i class="fas fa-location-dot"></i>
                    </div>
                    <div class="location-details">
                        <p class="location-name">
                            <i class="fas fa-map-marker-alt"></i> 
                            Desa Sumberejo, Kecamatan Pagelaran, Kabupaten Pringsewu, Provinsi Lampung
                        </p>
                    </div>
                </div>
            </div>

            {% if weather.error %}
                <!-- Error State -->
                <div class="card error-card">
                    <div class="error-header">
                        <div class="error-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3>Terjadi Kesalahan</h3>
                    </div>
                    <div class="error-content">
                        <p class="error-message">{{ weather.error }}</p>
                        <div class="error-solutions">
                            <h4><i class="fas fa-lightbulb"></i> Solusi Pemecahan Masalah:</h4>
                            <ul class="solution-list">
                                <li>
                                    <i class="fas fa-wifi"></i>
                                    <span>Periksa koneksi internet Anda</span>
                                </li>
                                <li>
                                    <i class="fas fa-key"></i>
                                    <span>Pastikan API Key OpenWeatherMap sudah benar</span>
                                </li>
                                <li>
                                    <i class="fas fa-code"></i>
                                    <span>Buka <code>cuaca/views.py</code> dan ganti <code>YOUR_API_KEY_HERE</code></span>
                                </li>
                            </ul>
                            <a href="https://openweathermap.org/api" target="_blank" class="api-link">
                                <i class="fas fa-external-link-alt"></i>
                                Daftar di OpenWeatherMap untuk mendapatkan API Key
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Weather Info - Main Card -->
                <div class="card weather-main-card">
                    <div class="weather-emoji-container">
                        <div class="weather-emoji">{{ weather.weather_emoji }}</div>
                        <div class="weather-emoji-bg"></div>
                    </div>
                    
                    <div class="weather-main-info">
                        <div class="temperature-section">
                            <div class="temperature-display">
                                <span class="temp-value">{{ weather.temperature }}</span>
                                <span class="temp-unit">¬∞C</span>
                            </div>
                            <div class="temperature-feel">
                                <i class="fas fa-temperature-half"></i>
                                <span>Terasa seperti <strong>{{ weather.feels_like }}¬∞C</strong></span>
                            </div>
                        </div>
                        
                        <div class="condition-section">
                            <h3 class="condition-text">{{ weather.condition }}</h3>
                            <p class="description">{{ weather.description }}</p>
                            <div class="condition-details">
                                <span class="detail-item">
                                    <i class="fas fa-sun"></i>
                                    <span>Siang: {{ weather.temperature_max }}¬∞C</span>
                                </span>
                                <span class="detail-item">
                                    <i class="fas fa-moon"></i>
                                    <span>Malam: {{ weather.temperature_min }}¬∞C</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weather Details Grid -->
                <div class="weather-grid">
                    <!-- Humidity Card -->
                    <div class="card stat-card humidity">
                        <div class="stat-icon">
                            <i class="fas fa-tint"></i>
                            <div class="icon-bg"></div>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Kelembaban</h3>
                            <div class="stat-value-container">
                                <p class="stat-value">{{ weather.humidity }}<span class="unit">%</span></p>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ weather.humidity }}%"></div>
                                </div>
                            </div>
                            <p class="stat-description">
                                {% if weather.humidity > 80 %}
                                    <i class="fas fa-exclamation-circle"></i> Sangat lembab
                                {% elif weather.humidity > 60 %}
                                    <i class="fas fa-check-circle"></i> Lembab
                                {% else %}
                                    <i class="fas fa-check-circle"></i> Normal
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <!-- Wind Speed Card -->
                    <div class="card stat-card wind">
                        <div class="stat-icon">
                            <i class="fas fa-wind"></i>
                            <div class="icon-bg"></div>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Kecepatan Angin</h3>
                            <div class="stat-value-container">
                                <p class="stat-value">{{ weather.wind_speed }}<span class="unit"> m/s</span></p>
                                <div class="wind-direction">
                                    <i class="fas fa-arrow-up" style="transform: rotate({{ weather.wind_deg|default:0 }}deg)"></i>
                                    <span>{{ weather.wind_deg|default:0 }}¬∞</span>
                                </div>
                            </div>
                            <p class="stat-description">
                                {% if weather.wind_speed > 10 %}
                                    <i class="fas fa-exclamation-circle"></i> Angin kuat
                                {% elif weather.wind_speed > 5 %}
                                    <i class="fas fa-check-circle"></i> Angin sedang
                                {% else %}
                                    <i class="fas fa-check-circle"></i> Angin lemah
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <!-- Pressure Card -->
                    <div class="card stat-card pressure">
                        <div class="stat-icon">
                            <i class="fas fa-gauge-high"></i>
                            <div class="icon-bg"></div>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Tekanan Udara</h3>
                            <div class="stat-value-container">
                                <p class="stat-value">{{ weather.pressure }}<span class="unit"> hPa</span></p>
                                <div class="pressure-indicator">
                                    <div class="indicator-dot {% if weather.pressure > 1015 %}high{% else %}low{% endif %}"></div>
                                    <span class="indicator-label">
                                        {% if weather.pressure > 1015 %}
                                            Tinggi
                                        {% else %}
                                            Rendah
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <p class="stat-description">
                                Tekanan atmosfer saat ini
                            </p>
                        </div>
                    </div>

                    <!-- Cloud Coverage Card -->
                    <div class="card stat-card clouds">
                        <div class="stat-icon">
                            <i class="fas fa-cloud"></i>
                            <div class="icon-bg"></div>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Tutupan Awan</h3>
                            <div class="stat-value-container">
                                <p class="stat-value">{{ weather.cloudiness }}<span class="unit">%</span></p>
                                <div class="cloud-visual">
                                    <div class="cloud-visual-bg">
                                        {% for i in "12345" %}
                                            <div class="cloud-dot {% if forloop.counter <= weather.cloudiness|divisibleby:20 %}filled{% endif %}"></div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <p class="stat-description">
                                {% if weather.cloudiness > 70 %}
                                    <i class="fas fa-cloud"></i> Sangat berawan
                                {% elif weather.cloudiness > 40 %}
                                    <i class="fas fa-cloud-sun"></i> Berawan
                                {% else %}
                                    <i class="fas fa-sun"></i> Cerah
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <!-- Temperature Range Card -->
                    <div class="card stat-card temperature-range">
                        <div class="stat-icon">
                            <i class="fas fa-thermometer-half"></i>
                            <div class="icon-bg"></div>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Rentang Suhu</h3>
                            <div class="temp-range-container">
                                <div class="temp-min">
                                    <span class="temp-label">Malam</span>
                                    <span class="temp-value">{{ weather.temperature_min }}¬∞C</span>
                                </div>
                                <div class="temp-range-bar">
                                    <div class="range-fill"></div>
                                </div>
                                <div class="temp-max">
                                    <span class="temp-label">Siang</span>
                                    <span class="temp-value">{{ weather.temperature_max }}¬∞C</span>
                                </div>
                            </div>
                            <p class="stat-description">
                                <i class="fas fa-info-circle"></i> Rentang: {{ weather.temperature_max|add:weather.temperature_min|floatformat:0 }}¬∞C
                            </p>
                        </div>
                    </div>

                    <!-- Visibility Card -->
                    <div class="card stat-card visibility">
                        <div class="stat-icon">
                            <i class="fas fa-eye"></i>
                            <div class="icon-bg"></div>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-label">Visibilitas</h3>
                            <div class="stat-value-container">
                                <p class="stat-value">{{ weather.visibility|floatformat:1 }}<span class="unit"> km</span></p>
                                <div class="visibility-indicator">
                                    <div class="indicator-bar {% if weather.visibility > 10 %}excellent{% elif weather.visibility > 5 %}good{% else %}poor{% endif %}"></div>
                                </div>
                            </div>
                            <p class="stat-description">
                                {% if weather.visibility > 10 %}
                                    <i class="fas fa-check-circle"></i> Sangat jelas
                                {% elif weather.visibility > 5 %}
                                    <i class="fas fa-check-circle"></i> Jelas
                                {% else %}
                                    <i class="fas fa-exclamation-circle"></i> Berkabut
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

<!-- Forecast 7 Hari - Versi Baru -->
<div class="forecast-section">
    <div class="section-header">
        <div class="header-title">
            <div class="title-icon">
                <i class="fas fa-calendar-days"></i>
            </div>
            <div class="title-text">
                <h2>Prakiraan Cuaca 7 Hari</h2>
                <p class="section-subtitle">Ramalan cuaca untuk seminggu ke depan di Desa Sumberejo</p>
            </div>
        </div>
        <div class="header-controls">
            <div class="forecast-navigation">
                <button class="nav-btn prev-btn" id="forecastPrev">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="nav-btn next-btn" id="forecastNext">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
    
    <div class="forecast-container">
        <div class="forecast-scroll" id="forecastScroll">
            {% for day in forecast %}
            <div class="forecast-day-card">
                <div class="day-header">
                    <div class="day-name">{{ day.day_name|upper }}</div>
                    <div class="day-date">{{ day.date }}</div>
                </div>
                
                <div class="weather-icon-wrapper">
                    <div class="weather-icon-bg"></div>
                    <div class="weather-icon">{{ day.weather_emoji }}</div>
                </div>
                
                <div class="temperature-display">
                    <div class="temp-item">
                        <span class="temp-value-max">{{ day.temperature_max }}¬∞</span>
                        <span class="temp-label">Tertinggi</span>
                    </div>
                    <div class="temp-separator"></div>
                    <div class="temp-item">
                        <span class="temp-value-min">{{ day.temperature_min }}¬∞</span>
                        <span class="temp-label">Terendah</span>
                    </div>
                </div>
                
                <div class="weather-condition">
                    <span class="condition-text">{{ day.condition }}</span>
                </div>
                
                <div class="weather-details">
                    <div class="detail-row">
                        <div class="detail-item">
                            <div class="detail-icon humidity-icon">
                                <i class="fas fa-droplet"></i>
                            </div>
                            <div class="detail-content">
                                <span class="detail-value">{{ day.humidity }}%</span>
                                <span class="detail-label">Kelembaban</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon wind-icon">
                                <i class="fas fa-wind"></i>
                            </div>
                            <div class="detail-content">
                                <span class="detail-value">{{ day.wind_speed }} m/s</span>
                                <span class="detail-label">Angin</span>
                            </div>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-item">
                            <div class="detail-icon cloud-icon">
                                <i class="fas fa-cloud"></i>
                            </div>
                            <div class="detail-content">
                                <span class="detail-value">{{ day.cloudiness }}%</span>
                                <span class="detail-label">Awan</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon rain-icon">
                                <i class="fas fa-cloud-rain"></i>
                            </div>
                            <div class="detail-content">
                                <span class="detail-value">{{ day.precipitation|floatformat:0 }}%</span>
                                <span class="detail-label">Hujan</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="day-footer">
                    <div class="sun-times">
                        <div class="sun-time sunrise">
                            <i class="fas fa-sunrise"></i>
                            <span>{{ day.sunrise|default:"06:00" }}</span>
                        </div>
                        <div class="sun-time sunset">
                            <i class="fas fa-sunset"></i>
                            <span>{{ day.sunset|default:"18:00" }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="forecast-indicator">
            <div class="indicator-dots" id="forecastDots"></div>
        </div>
    </div>
    
    <div class="forecast-summary">
        <div class="summary-card">
            <div class="summary-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="summary-content">
                <h3>Ringkasan Mingguan</h3>
                <p>
                    Rata-rata suhu: <strong>{{ forecast_summary.avg_temp }}¬∞C</strong> | 
                    Hari terpanas: <strong>{{ forecast_summary.hottest_day }}</strong> | 
                    Curah hujan: <strong>{{ forecast_summary.total_rainfall }}mm</strong>
                </p>
            </div>
        </div>
    </div>
</div>
                <!-- Last Update -->
                <div class="card update-card">
                    <div class="update-content">
                        <div class="update-info">
                            <div class="update-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="update-details">
                                <p class="update-text">Pembaruan terakhir: <strong>{{ weather.update_time }}</strong></p>
                                <p class="update-refresh">Data diperbarui setiap kali halaman dimuat</p>
                            </div>
                        </div>
                        <button class="refresh-btn" id="manualRefresh">
                            <i class="fas fa-sync-alt"></i>
                            Refresh Sekarang
                        </button>
                    </div>
                </div>
            {% endif %}
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="footer-logo-icon">üå§Ô∏è</div>
                    <div class="footer-logo-text">
                        <h3>E-Cuaca</h3>
                        <p>Sistem Monitoring Cuaca</p>
                    </div>
                </div>
                <div class="footer-info">
                    <p class="footer-text">
                        <i class="fas fa-graduation-cap"></i> Praktik Kerja Nyata (PKN)
                    </p>
                    <p class="footer-text">
                        <i class="fas fa-building"></i> Politeknik Negeri Lampung
                    </p>
                    <p class="footer-text">
                        <i class="fas fa-map-marker-alt"></i> Desa Sumberejo, Kecamatan Pagelaran, Kabupaten Pringsewu, Lampung
                    </p>
                    <p class="footer-note">
                        <i class="fas fa-database"></i> Data cuaca diambil dari 
                        <a href="https://openweathermap.org" target="_blank">OpenWeatherMap API</a>
                    </p>
                </div>
                <div class="footer-year">
                    <p>¬© 2026 E-Cuaca</p>
                    <p class="footer-version">v2.1.0</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Script untuk auto-refresh dan interaksi -->
    <script>
        // ========== Forecast Navigation ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi forecast navigation
            initForecastNavigation();
            
            // Set precipitation bar width
            const precipitationCards = document.querySelectorAll('.precipitation-chance');
            precipitationCards.forEach(card => {
                const chance = parseFloat(card.dataset.chance) || 0;
                const fill = card.querySelector('.precipitation-fill');
                if (fill) {
                    fill.style.setProperty('--rain-chance', `${chance}%`);
                }
            });
        });
        
        function initForecastNavigation() {
            const forecastScroll = document.getElementById('forecastScroll');
            const forecastDots = document.getElementById('forecastDots');
            const prevBtn = document.getElementById('forecastPrev');
            const nextBtn = document.getElementById('forecastNext');
            
            if (!forecastScroll) return;
            
            const cards = forecastScroll.querySelectorAll('.forecast-day-card');
            const cardWidth = cards[0]?.offsetWidth + 20; // 20px gap
            
            // Create indicator dots
            cards.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = 'dot';
                if (index === 0) dot.classList.add('active');
                
                dot.addEventListener('click', () => {
                    forecastScroll.scrollLeft = index * cardWidth;
                    updateDots();
                });
                
                forecastDots.appendChild(dot);
            });
            
            // Update dots on scroll
            forecastScroll.addEventListener('scroll', updateDots);
            
            function updateDots() {
                const dots = forecastDots.querySelectorAll('.dot');
                const scrollLeft = forecastScroll.scrollLeft;
                const activeIndex = Math.round(scrollLeft / cardWidth);
                
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === activeIndex);
                });
                
                // Update button states
                updateButtonStates();
            }
            
            function updateButtonStates() {
                const scrollLeft = forecastScroll.scrollLeft;
                const maxScroll = forecastScroll.scrollWidth - forecastScroll.clientWidth;
                
                prevBtn.disabled = scrollLeft <= 0;
                nextBtn.disabled = scrollLeft >= maxScroll - 10;
            }
            
            // Navigation button click handlers
            prevBtn.addEventListener('click', () => {
                forecastScroll.scrollLeft -= cardWidth;
            });
            
            nextBtn.addEventListener('click', () => {
                forecastScroll.scrollLeft += cardWidth;
            });
            
            // Initial state
            updateButtonStates();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                updateButtonStates();
            });
        }
        
        // ========== Auto-Refresh dan Countdown ==========
        const AUTO_REFRESH_INTERVAL = 10 * 60 * 1000;
        let refreshCountdown = AUTO_REFRESH_INTERVAL / 1000;
        let countdownInterval;
        
        // Format waktu dalam menit:detik
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Update countdown display
        function updateCountdownDisplay() {
            document.getElementById('countdown').textContent = formatTime(refreshCountdown);
        }
        
        // Start countdown
        function startCountdown() {
            refreshCountdown = AUTO_REFRESH_INTERVAL / 1000;
            updateCountdownDisplay();
            
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(function() {
                refreshCountdown--;
                updateCountdownDisplay();
                
                if (refreshCountdown <= 0) {
                    location.reload();
                }
            }, 1000);
        }
        
        // Manual refresh
        document.getElementById('manualRefresh').addEventListener('click', function() {
            this.classList.add('refreshing');
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memuat...';
            
            setTimeout(function() {
                location.reload();
            }, 500);
        });
        
        // Start countdown on page load
        document.addEventListener('DOMContentLoaded', function() {
            startCountdown();
            
            // Add subtle animations to cards
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('animate-in');
            });
            
            // Animate stat card icons on hover
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                const icon = card.querySelector('.stat-icon i');
                
                card.addEventListener('mouseenter', function() {
                    if (icon) {
                        icon.style.filter = 'brightness(1.3) drop-shadow(0 0 20px currentColor)';
                    }
                });
                
                card.addEventListener('mouseleave', function() {
                    if (icon) {
                        icon.style.filter = 'brightness(1)';
                    }
                });
            });
        });
        
        // Auto-refresh timeout
        setTimeout(function() {
            location.reload();
        }, AUTO_REFRESH_INTERVAL);
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>